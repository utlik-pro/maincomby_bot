# ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –∫–∞–Ω–∞–ª @maincomby - –ê–ö–¢–ò–í–ò–†–û–í–ê–ù–ê

## –°—Ç–∞—Ç—É—Å: üü¢ –†–ê–ë–û–¢–ê–ï–¢

–î–∞—Ç–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏: 2025-12-10
–ö–∞–Ω–∞–ª: https://t.me/maincomby
ID –∫–∞–Ω–∞–ª–∞: `-1002494730191`

---

## –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### ‚úÖ Middleware –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏
- –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ: `app/main.py:47-91`
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å–∫—É –¥–ª—è –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –∏ callback-–∑–∞–ø—Ä–æ—Å–æ–≤
- –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –∏–∑ `ADMIN_IDS` –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### ‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–Ø –ø–æ–¥–ø–∏—Å–∞–ª—Å—è"
- –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ: `app/main.py:96-116`
- –ü–æ–≤—Ç–æ—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å–∫—É –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏
- –£–¥–∞–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏

### ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```env
CHECK_SUBSCRIPTION_CHANNEL_ID=-1002494730191
CHECK_SUBSCRIPTION_CHANNEL_URL=https://t.me/maincomby
```

### ‚úÖ –ü—Ä–∞–≤–∞ –±–æ—Ç–∞
- –ë–æ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –∫–∞–∫ **–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä** –≤ –∫–∞–Ω–∞–ª @maincomby
- –ò–º–µ–µ—Ç –ø—Ä–∞–≤–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∫–∞–Ω–∞–ª–∞

---

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ù–ï –ø–æ–¥–ø–∏—Å–∞–Ω
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç—É
2. Middleware –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å–∫—É —á–µ—Ä–µ–∑ `bot.get_chat_member()`
3. –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å –ù–ï –≤ `["member", "administrator", "creator"]`:
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–∞–º–∏:
     - üîó **–ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞–Ω–∞–ª** ‚Üí https://t.me/maincomby
     - ‚úÖ **–Ø –ø–æ–¥–ø–∏—Å–∞–ª—Å—è** ‚Üí –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
4. –î–∞–ª—å–Ω–µ–π—à–µ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥–ø–∏—Å–∞–Ω
1. Middleware –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å–∫—É
2. –°—Ç–∞—Ç—É—Å –≤ `["member", "administrator", "creator"]` ‚Üí ‚úÖ
3. –ó–∞–ø—Ä–æ—Å –ø—Ä–æ—Ö–æ–¥–∏—Ç –¥–∞–ª—å—à–µ –∫ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –±–æ—Ç–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ **–ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è**
- –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –î–ª—è –æ–±—ã—á–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
1. –ù–∞–ø–∏—à–∏—Ç–µ –±–æ—Ç—É **(–ù–ï –æ—Ç –∏–º–µ–Ω–∏ –∞–¥–º–∏–Ω–∞)**
2. –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –ø–æ–ø—Ä–æ—Å–∏—Ç—å –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–∞–Ω–∞–ª
3. –ü–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ https://t.me/maincomby
4. –ù–∞–∂–º–∏—Ç–µ **"‚úÖ –Ø –ø–æ–¥–ø–∏—Å–∞–ª—Å—è"**
5. –°–æ–æ–±—â–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –∏—Å—á–µ–∑–Ω—É—Ç—å, –¥–æ—Å—Ç—É–ø –æ—Ç–∫—Ä—ã—Ç

### –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:
1. –ù–∞–ø–∏—à–∏—Ç–µ –±–æ—Ç—É –æ—Ç –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ `ADMIN_IDS`
2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø—Ä–æ–ø—É—â–µ–Ω–∞
3. –ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –∫–∞–∫ –æ–±—ã—á–Ω–æ

---

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ó–∞—â–∏—Ç–∞ –æ—Ç –æ–±—Ö–æ–¥–∞:
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ **–∫–∞–∂–¥–æ–º** –∑–∞–ø—Ä–æ—Å–µ (message + callback_query)
- ‚úÖ Middleware —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∫–∞–∫ `outer_middleware()` (–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–µ—Ä–≤—ã–º)
- ‚úÖ –ü—Ä–∏ –æ—à–∏–±–∫–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –±–æ—Ç –Ω–µ –∞–¥–º–∏–Ω) - –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è (fail-open)
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏

### –ò—Å–∫–ª—é—á–µ–Ω–∏—è:
- –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –∏–∑ `ADMIN_IDS` –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è
- –ï—Å–ª–∏ `CHECK_SUBSCRIPTION_CHANNEL_ID` –∏–ª–∏ `CHECK_SUBSCRIPTION_CHANNEL_URL` –Ω–µ –∑–∞–¥–∞–Ω—ã ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞

---

## –õ–æ–≥–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã:
```bash
# –õ–æ–≥–∏ –±–æ—Ç–∞
docker compose logs -f maincomby_bot

# –ü–æ–∏—Å–∫ –æ—à–∏–±–æ–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏
docker compose logs | grep -i "–ø–æ–¥–ø–∏—Å–∫\|subscription"

# –°—Ç–∞—Ç—É—Å –±–æ—Ç–∞
docker compose ps
```

### –¢–∏–ø–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ª–æ–≥–∞—Ö:
```
[MIDDLEWARE] Message received: chat_type=private, chat_id=123456, user_id=123456, text=/start
–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏ –¥–ª—è user_id=123456: ...  # –ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π
```

---

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –û—Ç–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É:
–ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –≤ `.env`:
```env
# CHECK_SUBSCRIPTION_CHANNEL_ID=-1002494730191
# CHECK_SUBSCRIPTION_CHANNEL_URL=https://t.me/maincomby
```

### –ò–∑–º–µ–Ω–∏—Ç—å –∫–∞–Ω–∞–ª:
1. –î–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –∞–¥–º–∏–Ω–æ–º –≤ –Ω–æ–≤—ã–π –∫–∞–Ω–∞–ª
2. –ü–æ–ª—É—á–∏—Ç–µ ID: `python3 check_channel_access.py @–Ω–æ–≤—ã–π_–∫–∞–Ω–∞–ª`
3. –û–±–Ω–æ–≤–∏—Ç–µ `.env`
4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ: `docker compose restart`

---

## –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `app/main.py:47-116` - Middleware –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
- `app/config.py:47-50` - –ü–æ–ª—è –≤ Settings
- `.env:18-19` - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- `get_channel_id.py` - –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è ID (—á–µ—Ä–µ–∑ –ø–µ—Ä–µ—Å—ã–ª–∫—É)
- `check_channel_access.py` - –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–∞ (—á–µ—Ä–µ–∑ API)

---

## –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ë–æ—Ç –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å–∫—É:
```bash
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ .env –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
sshpass -p 'password' ssh root@104.253.1.54 "cat /root/maincomby_bot/.env | grep CHECK_"

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –±–æ—Ç–∞ –≤ –∫–∞–Ω–∞–ª–µ
python3 check_channel_access.py

# 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞
docker compose restart
```

### –ë–æ—Ç –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É:
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–æ—Ç **–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä** –∫–∞–Ω–∞–ª–∞
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ ID –∫–∞–Ω–∞–ª–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π (–¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å `-100`)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏ API Telegram

### –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã —Ç–æ–∂–µ –ø—Ä–æ—Ö–æ–¥—è—Ç –ø—Ä–æ–≤–µ—Ä–∫—É:
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Ö ID –≤ `ADMIN_IDS` (–≤ `.env`)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `[CONFIG] Loaded admin_ids: [...]`

---

## –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

### 2025-12-10
- ‚úÖ –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –∫–∞–Ω–∞–ª @maincomby
- ‚úÖ –ë–æ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –∫–∞–Ω–∞–ª–∞
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –≤ `.env`
- ‚úÖ –ë–æ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ `104.253.1.54`
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

---

**–°—Ç–∞—Ç—É—Å:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ **–ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞** –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üéâ
