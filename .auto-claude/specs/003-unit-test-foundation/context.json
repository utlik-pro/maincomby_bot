{
  "task_description": "# Unit Test Foundation\n\nEstablish automated testing infrastructure with Vitest, React Testing Library, and initial test coverage for critical components and business logic.\n\n## Rationale\nCurrently there is no test coverage (identified as technical debt). As features grow, lack of tests increases bug risk and slows development. Starting with critical paths establishes testing culture early.\n\n## User Stories\n- As a developer, I want automated tests so I can refactor with confidence\n- As a maintainer, I want CI tests so bugs are caught before deployment\n- As a contributor, I want test examples so I know how to test new features\n\n## Acceptance Criteria\n- [ ] Vitest and React Testing Library configured in project\n- [ ] Test scripts added to package.json\n- [ ] Unit tests for XP calculation and rank progression logic\n- [ ] Component tests for critical UI components (ProfileCard, EventCard)\n- [ ] Integration tests for Supabase authentication flow\n- [ ] CI pipeline runs tests on pull requests\n- [ ] Code coverage reporting enabled\n",
  "scoped_services": ["main"],
  "files_to_modify": {
    "main": [
      "package.json",
      ".github/workflows/test.yml"
    ]
  },
  "files_to_create": {
    "main": [
      "vitest.config.ts",
      "src/test/setup.ts",
      "src/lib/__tests__/store.test.ts",
      "src/types/__tests__/ranks.test.ts",
      "src/components/__tests__/ProfileCard.test.tsx",
      "src/components/__tests__/EventCard.test.tsx",
      "src/lib/__tests__/supabase.test.ts"
    ]
  },
  "files_to_reference": [
    "src/lib/store.ts",
    "src/types/index.ts",
    "src/lib/supabase.ts",
    "src/screens/ProfileScreen.tsx",
    "src/screens/EventsScreen.tsx",
    "vite.config.ts"
  ],
  "patterns": {
    "testing": "No existing test patterns - greenfield setup",
    "state_management": "Zustand with computed getters (getRank, getRankProgress)",
    "component_pattern": "Functional components with hooks, no standalone ProfileCard/EventCard yet",
    "auth_pattern": "Telegram WebApp authentication via createOrUpdateUser and getUserByTelegramId"
  },
  "existing_implementations": {
    "description": "Found XP and rank calculation logic in store.ts, but ProfileCard/EventCard do not exist as standalone components - they are embedded in ProfileScreen and EventsScreen",
    "relevant_files": [
      "src/lib/store.ts (calculateRank, calculateRankProgress, addPoints)",
      "src/types/index.ts (RANK_THRESHOLDS, XP_REWARDS, rank type definitions)",
      "src/lib/supabase.ts (getUserByTelegramId, createOrUpdateUser for auth)",
      "src/screens/ProfileScreen.tsx (embedded profile display logic)",
      "src/screens/EventsScreen.tsx (embedded event display logic)"
    ]
  },
  "critical_findings": {
    "components_missing": "ProfileCard and EventCard do not exist as standalone components. Options: (1) Extract them first, then test, or (2) Create them as part of this task, or (3) Test the profile/event rendering logic in the screens directly",
    "auth_type": "Uses Telegram WebApp authentication, not traditional Supabase auth with email/password",
    "xp_logic_location": "src/lib/store.ts contains calculateRank() and calculateRankProgress() functions",
    "port": "Dev server runs on port 5173, not 3000 as mentioned in spec",
    "ci_setup": "No existing .github/workflows directory - needs to be created"
  },
  "created_at": "2026-01-03T21:15:10.985507"
}