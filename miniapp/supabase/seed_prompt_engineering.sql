-- =====================================================
-- Курс "Основы промптинга" для Telegram Mini App
-- С поддержкой квизов
-- =====================================================

-- Удалить существующие данные (если есть)
DELETE FROM lessons WHERE course_id = 'prompt-engineering';
DELETE FROM courses WHERE id = 'prompt-engineering';

-- Вставить курс
INSERT INTO courses (id, title, description, icon, color, sort_order, is_enabled)
VALUES (
  'prompt-engineering',
  'Основы промптинга',
  'Научитесь создавать эффективные промпты для AI. 7 уроков, практические примеры.',
  'Sparkles',
  '#c8ff00',
  1,
  true
);

-- =====================================================
-- Урок 1: Почему AI не понимает тебя
-- =====================================================
INSERT INTO lessons (id, course_id, title, duration_minutes, content, sort_order, is_enabled)
VALUES (
  'pe-lesson-1',
  'prompt-engineering',
  'Почему AI не понимает тебя',
  10,
  '[
    {"type": "heading", "content": "Миф: AI читает мысли"},
    {"type": "text", "content": "Многие думают, что достаточно написать \"сделай красиво\" или \"напиши хорошо\", и AI поймёт, что они имеют в виду."},
    {"type": "tip", "content": "Реальность: AI не читает мысли. Он видит только текст, который вы написали. Ничего больше."},

    {"type": "heading", "content": "Как на самом деле работает AI"},
    {"type": "text", "content": "Языковая модель (LLM) — это система, которая предсказывает следующее слово на основе предыдущих."},
    {"type": "list", "content": "Когда вы пишете запрос, AI:", "items": [
      "Читает ваш текст буквально",
      "Ищет паттерны из обучающих данных",
      "Генерирует наиболее вероятное продолжение"
    ]},
    {"type": "tip", "content": "Ключевой инсайт: AI не понимает контекст вашей жизни, работы или намерений. Он работает только с тем текстом, который вы ему дали."},

    {"type": "heading", "content": "Главная ошибка"},
    {"type": "text", "content": "Мы предполагаем, что AI знает контекст. Но он его не знает!"},
    {"type": "example", "content": "Напиши текст про маркетинг", "good": false},
    {"type": "text", "content": "Результат: Общий, скучный текст на 500 слов о том, что такое маркетинг. Не полезно ни для чего конкретного."},

    {"type": "heading", "content": "Пример хорошего промпта"},
    {"type": "example", "content": "Ты — маркетолог с 10-летним опытом в B2B SaaS.\n\nНапиши пост для LinkedIn о 3 главных трендах B2B маркетинга в 2025 году.\n\nТребования:\n- Длина: 200-250 слов\n- Стиль: профессиональный, но живой\n- Добавь 1-2 emoji для акцентов\n- В конце задай вопрос для вовлечения", "good": true},
    {"type": "text", "content": "Результат: Точный, готовый к публикации пост для LinkedIn."},

    {"type": "heading", "content": "Формула эффективного промпта"},
    {"type": "tip", "content": "Хороший промпт = Контекст + Задача + Формат. Чем больше деталей вы даёте, тем точнее ответ."},

    {"type": "heading", "content": "Проверка понимания"},
    {"type": "quiz", "content": "Почему AI даёт неточные ответы на короткие запросы?", "options": [
      "Потому что AI глупый и не понимает русский язык",
      "Потому что AI не знает контекст и работает только с данным текстом",
      "Потому что нужно платить за премиум версию",
      "Потому что AI специально даёт плохие ответы"
    ], "correctIndex": 1},

    {"type": "list", "content": "Ключевые выводы:", "items": [
      "AI не читает мысли — он работает только с текстом",
      "Контекст не подразумевается — его нужно явно указывать",
      "Формула успеха: Контекст + Задача + Формат"
    ]}
  ]'::jsonb,
  1,
  true
);

-- =====================================================
-- Урок 2: Анатомия идеального промпта (RISEN)
-- =====================================================
INSERT INTO lessons (id, course_id, title, duration_minutes, content, sort_order, is_enabled)
VALUES (
  'pe-lesson-2',
  'prompt-engineering',
  'Анатомия промпта: фреймворк RISEN',
  15,
  '[
    {"type": "heading", "content": "Зачем нужна структура?"},
    {"type": "text", "content": "В предыдущем уроке мы узнали, что AI не читает мысли. Теперь давайте научимся давать AI всю необходимую информацию в правильном формате."},
    {"type": "tip", "content": "Аналогия: Представьте, что вы даёте задание новому сотруднику. Чем чётче вы объясните — тем лучше он справится."},

    {"type": "heading", "content": "Фреймворк RISEN"},
    {"type": "text", "content": "R — I — S — E — N — универсальная структура для создания эффективных промптов."},

    {"type": "heading", "content": "R — Role (Роль)"},
    {"type": "text", "content": "Кем должен быть AI? Роль задаёт экспертизу, стиль общения и точку зрения."},
    {"type": "example", "content": "Ты — опытный маркетолог с 10-летним опытом в B2B\n\nТы — строгий редактор научного журнала\n\nТы — дружелюбный учитель для детей 7-10 лет", "good": true},

    {"type": "heading", "content": "I — Instructions (Инструкции)"},
    {"type": "text", "content": "Что нужно сделать? Чёткое описание задачи с глаголами действия."},
    {"type": "example", "content": "Сделай что-то с этим текстом", "good": false},
    {"type": "example", "content": "Перепиши текст, сделав его короче на 50%", "good": true},

    {"type": "heading", "content": "S — Steps (Шаги)"},
    {"type": "text", "content": "Как выполнить задачу? Пошаговый алгоритм действий."},
    {"type": "example", "content": "Выполни анализ в следующем порядке:\n1. Прочитай текст и выдели главную мысль\n2. Найди 3 ключевых аргумента\n3. Оцени силу каждого по шкале 1-10\n4. Дай общую оценку", "good": true},

    {"type": "heading", "content": "E — End Goal (Цель)"},
    {"type": "text", "content": "Какой результат нужен? Формат, длина, стиль."},
    {"type": "example", "content": "Формат: маркированный список из 5-7 пунктов\nДлина: 200-250 слов\nСтиль: профессиональный, но дружелюбный", "good": true},

    {"type": "heading", "content": "N — Narrowing (Ограничения)"},
    {"type": "text", "content": "Чего избегать? Границы и запреты."},
    {"type": "example", "content": "Не используй:\n- Сложные технические термины\n- Пассивный залог\n- Фразы длиннее 20 слов\n- Клише и штампы", "good": true},

    {"type": "heading", "content": "Гибкость фреймворка"},
    {"type": "list", "content": "Не все компоненты обязательны:", "items": [
      "Простая задача: R + I",
      "Средняя задача: R + I + E",
      "Сложная задача: R + I + S + E + N"
    ]},

    {"type": "heading", "content": "Проверка понимания"},
    {"type": "quiz", "content": "Какой компонент RISEN отвечает за то, чего AI должен избегать?", "options": [
      "R — Role (Роль)",
      "S — Steps (Шаги)",
      "E — End Goal (Цель)",
      "N — Narrowing (Ограничения)"
    ], "correctIndex": 3},

    {"type": "list", "content": "Ключевые выводы:", "items": [
      "R — Role: Кем должен быть AI",
      "I — Instructions: Что нужно сделать",
      "S — Steps: Как выполнить",
      "E — End Goal: Какой результат нужен",
      "N — Narrowing: Чего избегать"
    ]}
  ]'::jsonb,
  2,
  true
);

-- =====================================================
-- Урок 3: Роли и персоны
-- =====================================================
INSERT INTO lessons (id, course_id, title, duration_minutes, content, sort_order, is_enabled)
VALUES (
  'pe-lesson-3',
  'prompt-engineering',
  'Роли и персоны',
  15,
  '[
    {"type": "heading", "content": "Почему роли работают?"},
    {"type": "text", "content": "Когда вы задаёте AI роль, вы активируете определённый \"режим\" — набор знаний, стиля и подхода."},
    {"type": "tip", "content": "Аналогия: Это как переключение каналов на радио. Роль — это настройка на нужную волну."},

    {"type": "heading", "content": "Одна задача — разные роли"},
    {"type": "text", "content": "Задача: Оцени бизнес-идею \"Приложение для выгула собак\""},
    {"type": "list", "content": "Разные роли дают разные ответы:", "items": [
      "Инвестор: \"Какой MOAT у продукта? Нужны данные о CAC и LTV.\"",
      "Маркетолог: \"Целевая аудитория — занятые миллениалы с собаками.\"",
      "Юрист: \"Главные риски: ответственность за травмы животных.\"",
      "Скептик: \"Люди не доверят собаку незнакомцу.\""
    ]},

    {"type": "heading", "content": "10 мощных ролей"},
    {"type": "list", "content": "Базовые роли для разных задач:", "items": [
      "Эксперт — глубокий анализ",
      "Критик — найти слабые места",
      "Редактор — улучшить стиль",
      "Учитель — объяснить просто",
      "Ментор — стратегический совет",
      "Скептик — неудобные вопросы",
      "Креатор — нестандартные решения",
      "Аналитик — разобрать данные",
      "Переговорщик — убедительные аргументы",
      "Психолог — понять мотивации"
    ]},

    {"type": "heading", "content": "От роли к персоне"},
    {"type": "text", "content": "Персона = Роль + Контекст + Стиль"},
    {"type": "example", "content": "Ты — маркетолог", "good": false},
    {"type": "example", "content": "Ты — Анна, маркетолог с 8-летним опытом в B2B SaaS.\nСпециализация: контент-маркетинг и LinkedIn.\nСтиль: профессиональный, но без корпоративного языка.", "good": true},

    {"type": "heading", "content": "Шаблон персоны"},
    {"type": "example", "content": "Ты — [профессия] с [опыт] опытом в [сфера].\n\nСпециализация: [узкая область]\n\nСтиль общения: [формальный/неформальный]\n\nОсобенности:\n- [характерная черта 1]\n- [характерная черта 2]", "good": true},

    {"type": "heading", "content": "Проверка понимания"},
    {"type": "quiz", "content": "Что входит в формулу персоны?", "options": [
      "Имя + Возраст + Страна",
      "Роль + Контекст + Стиль",
      "Задача + Формат + Длина",
      "Вопрос + Ответ + Пример"
    ], "correctIndex": 1},

    {"type": "list", "content": "Ключевые выводы:", "items": [
      "Роли активируют нужный \"режим\" AI",
      "Разные роли = разные результаты",
      "Персона = Роль + Контекст + Стиль",
      "Добавляйте опыт, сферу, особенности стиля"
    ]}
  ]'::jsonb,
  3,
  true
);

-- =====================================================
-- Урок 4: Chain-of-Thought
-- =====================================================
INSERT INTO lessons (id, course_id, title, duration_minutes, content, sort_order, is_enabled)
VALUES (
  'pe-lesson-4',
  'prompt-engineering',
  'Chain-of-Thought: Думай шаг за шагом',
  20,
  '[
    {"type": "heading", "content": "Проблема: AI ошибается в сложных задачах"},
    {"type": "text", "content": "Языковые модели не \"думают\" — они генерируют вероятный текст. В сложных задачах AI может \"перепрыгнуть\" к ответу, минуя важные шаги."},
    {"type": "tip", "content": "Типичные ошибки: неправильные расчёты, ошибки в логике, пропущенные факторы."},

    {"type": "heading", "content": "Решение: Chain-of-Thought (CoT)"},
    {"type": "text", "content": "Chain-of-Thought — техника, которая заставляет AI показывать ход рассуждений."},
    {"type": "tip", "content": "Ключевая фраза: \"Давай подумаем шаг за шагом\""},

    {"type": "heading", "content": "Почему это работает?"},
    {"type": "list", "content": "Когда AI записывает шаги:", "items": [
      "Каждый шаг становится контекстом для следующего",
      "AI \"проверяет\" себя на каждом этапе",
      "Ошибки легче заметить",
      "Результат более обоснованный"
    ]},

    {"type": "heading", "content": "Пример: математическая задача"},
    {"type": "text", "content": "В магазине было 23 яблока. Утром купили 6, после обеда привезли 12. Сколько стало?"},
    {"type": "example", "content": "В магазине стало 29 яблок.", "good": false},
    {"type": "example", "content": "Давай решим шаг за шагом:\n\n1. Изначально было: 23 яблока\n2. Утром купили (забрали): 23 - 6 = 17\n3. После обеда привезли: 17 + 12 = 29\n\nОтвет: 29 яблок", "good": true},

    {"type": "heading", "content": "Фразы-триггеры для CoT"},
    {"type": "example", "content": "Давай подумаем шаг за шагом.\n\nРассуждай вслух, показывая каждый шаг.\n\nОбъясни своё рассуждение перед ответом.\n\nСначала разбери задачу на части, потом реши.\n\nLet''s think step by step.", "good": true},

    {"type": "heading", "content": "Когда использовать CoT?"},
    {"type": "list", "content": "Используйте для:", "items": [
      "Математических расчётов",
      "Логических задач",
      "Многофакторного анализа",
      "Принятия решений",
      "Отладки кода"
    ]},
    {"type": "list", "content": "Не нужно для:", "items": [
      "Простых вопросов",
      "Творческого письма",
      "Перевода текста",
      "Генерации списков"
    ]},

    {"type": "heading", "content": "Проверка понимания"},
    {"type": "quiz", "content": "Для какой задачи Chain-of-Thought будет наиболее полезен?", "options": [
      "Написать поздравление с днём рождения",
      "Перевести абзац с английского на русский",
      "Проанализировать финансовый отчёт и найти проблемы",
      "Сгенерировать 10 идей для названия продукта"
    ], "correctIndex": 2},

    {"type": "list", "content": "Ключевые выводы:", "items": [
      "CoT — техника пошагового рассуждения",
      "Фраза: \"Давай подумаем шаг за шагом\"",
      "Повышает точность на 30-40%",
      "Используйте для сложных аналитических задач"
    ]}
  ]'::jsonb,
  4,
  true
);

-- =====================================================
-- Урок 5: Few-shot Learning
-- =====================================================
INSERT INTO lessons (id, course_id, title, duration_minutes, content, sort_order, is_enabled)
VALUES (
  'pe-lesson-5',
  'prompt-engineering',
  'Few-shot Learning: Учим на примерах',
  15,
  '[
    {"type": "heading", "content": "Концепция: обучение на примерах"},
    {"type": "text", "content": "Few-shot Learning — техника, при которой вы показываете AI примеры желаемого результата, и он понимает паттерн."},
    {"type": "tip", "content": "Аналогия: Вместо объяснения правил грамматики, вы показываете правильные предложения. AI сам выводит паттерн."},

    {"type": "heading", "content": "Три режима промптинга"},
    {"type": "list", "content": "Zero-shot (0 примеров):", "items": [
      "Просто инструкция, без примеров"
    ]},
    {"type": "list", "content": "One-shot (1 пример):", "items": [
      "Один пример для понимания формата"
    ]},
    {"type": "list", "content": "Few-shot (2-5 примеров):", "items": [
      "Несколько примеров для надёжного понимания"
    ]},

    {"type": "heading", "content": "Формат примеров"},
    {"type": "example", "content": "Input: [входные данные]\nOutput: [желаемый результат]\n\nInput: [входные данные]\nOutput: [желаемый результат]\n\nInput: [новые данные]\nOutput:", "good": true},
    {"type": "tip", "content": "Оставляйте \"Output:\" пустым для финального запроса — AI заполнит его сам."},

    {"type": "heading", "content": "Пример: извлечение данных"},
    {"type": "example", "content": "Извлеки контактную информацию:\n\nТекст: \"Меня зовут Анна Петрова, работаю в Яндексе. Пишите на anna.p@yandex.ru\"\nРезультат:\n- Имя: Анна Петрова\n- Компания: Яндекс\n- Email: anna.p@yandex.ru\n\nТекст: \"Я Дмитрий из Сбера, контакт dmitry@sber.ru\"\nРезультат:\n- Имя: Дмитрий\n- Компания: Сбер\n- Email: dmitry@sber.ru\n\nТекст: \"Мария Иванова из VK, m.ivanova@vk.team\"\nРезультат:", "good": true},

    {"type": "heading", "content": "Как выбирать примеры?"},
    {"type": "list", "content": "Правила выбора:", "items": [
      "Разнообразие: покажите разные случаи",
      "Репрезентативность: похожи на реальные данные",
      "Краткость: 2-5 примеров достаточно",
      "Консистентность: единый формат"
    ]},

    {"type": "heading", "content": "Комбинирование: Few-shot + CoT"},
    {"type": "text", "content": "Мощная комбинация: показываем не только результат, но и процесс рассуждения."},
    {"type": "example", "content": "Определи тональность:\n\nОтзыв: \"Доставка быстрая, но товар бракованный\"\nРассуждение: Позитив (доставка) перевешивается негативом (брак).\nТональность: Негативная\n\nОтзыв: \"Цена высокая, но качество того стоит!\"\nРассуждение:", "good": true},

    {"type": "heading", "content": "Проверка понимания"},
    {"type": "quiz", "content": "Сколько примеров оптимально использовать в Few-shot промпте?", "options": [
      "Чем больше, тем лучше (10-20 примеров)",
      "2-5 разнообразных примеров",
      "Всегда ровно 3 примера",
      "Примеры не нужны, достаточно инструкции"
    ], "correctIndex": 1},

    {"type": "list", "content": "Ключевые выводы:", "items": [
      "Few-shot — обучение на примерах",
      "Zero/One/Few: 0, 1 или 2-5 примеров",
      "Формат: Input → Output",
      "Комбинируйте: Few-shot + CoT"
    ]}
  ]'::jsonb,
  5,
  true
);

-- =====================================================
-- Урок 6: 10 готовых промптов
-- =====================================================
INSERT INTO lessons (id, course_id, title, duration_minutes, content, sort_order, is_enabled)
VALUES (
  'pe-lesson-6',
  'prompt-engineering',
  '10 готовых промптов для работы',
  15,
  '[
    {"type": "heading", "content": "Как использовать"},
    {"type": "tip", "content": "Скопируйте промпт, замените текст в [скобках] на свои данные. Работает в ChatGPT, Claude и других LLM."},

    {"type": "heading", "content": "1. Улучшить текст"},
    {"type": "example", "content": "Ты — редактор с опытом в [сфера].\n\nУлучши текст:\n- Сделай более [ясным/убедительным]\n- Сохрани ключевые идеи\n- Убери воду и повторы\n\nТекст:\n[вставь текст]", "good": true},

    {"type": "heading", "content": "2. Резюмировать документ"},
    {"type": "example", "content": "Создай структурированное резюме:\n\n1. Главная идея (1-2 предложения)\n2. Ключевые пункты (3-5 буллетов)\n3. Важные цифры/факты\n4. Выводы автора\n\nДокумент:\n[вставь текст]", "good": true},

    {"type": "heading", "content": "3. Объяснить код"},
    {"type": "example", "content": "Ты — senior-разработчик.\n\nОбъясни код:\n1. Что делает в целом\n2. Разбери каждый блок\n3. Укажи потенциальные проблемы\n4. Предложи улучшения\n\nКод:\n[вставь код]", "good": true},

    {"type": "heading", "content": "4. Написать email"},
    {"type": "example", "content": "Напиши профессиональный email:\n\nКому: [получатель]\nЦель: [что сообщить]\nТон: [формальный/дружелюбный]\n\nТребования:\n- Краткость (до 150 слов)\n- Чёткий призыв к действию", "good": true},

    {"type": "heading", "content": "5. Brainstorm идей"},
    {"type": "example", "content": "Ты — креативный директор.\n\nЗадача: [проблема или цель]\n\nСгенерируй 10 идей:\n- 3 очевидных решения\n- 4 нестандартных подхода\n- 3 \"безумных\" идеи\n\nДля каждой: описание, плюс, риск", "good": true},

    {"type": "heading", "content": "6. Найти слабые места"},
    {"type": "example", "content": "Ты — опытный критик и скептик.\n\nПроанализируй [идею/план]:\n\n1. 3 главных слабых места\n2. Скрытые риски\n3. Что может пойти не так\n4. Какие вопросы я не задал\n\nВ конце — как укрепить слабые места.", "good": true},

    {"type": "heading", "content": "7. Декомпозировать задачу"},
    {"type": "example", "content": "Ты — проджект-менеджер.\n\nЗадача: [описание]\n\nРазбей на шаги:\n1. Конечная цель\n2. 3-5 основных этапов\n3. Конкретные действия\n4. Зависимости\n5. Потенциальные блокеры\n\nФормат: чек-лист", "good": true},

    {"type": "heading", "content": "Советы по адаптации"},
    {"type": "list", "content": "Как улучшить промпты:", "items": [
      "Меняйте роли под задачу",
      "Добавляйте контекст сферы",
      "Уточняйте формат вывода",
      "Задавайте ограничения",
      "Комбинируйте с CoT и Few-shot"
    ]},

    {"type": "heading", "content": "Проверка понимания"},
    {"type": "quiz", "content": "Какой промпт лучше использовать для анализа бизнес-плана?", "options": [
      "Улучшить текст",
      "Brainstorm идей",
      "Найти слабые места",
      "Объяснить как учитель"
    ], "correctIndex": 2},

    {"type": "list", "content": "Ключевые выводы:", "items": [
      "10 промптов покрывают большинство задач",
      "Адаптируйте под себя",
      "Создайте свою библиотеку промптов",
      "Практикуйтесь!"
    ]}
  ]'::jsonb,
  6,
  true
);

-- =====================================================
-- Урок 7: Домашнее задание
-- =====================================================
INSERT INTO lessons (id, course_id, title, duration_minutes, content, sort_order, is_enabled)
VALUES (
  'pe-lesson-7',
  'prompt-engineering',
  'Домашнее задание: создай свой промпт',
  10,
  '[
    {"type": "heading", "content": "Задание"},
    {"type": "text", "content": "Создайте промпт для задачи из вашей сферы работы или интересов."},

    {"type": "heading", "content": "Обязательные элементы"},
    {"type": "list", "content": "Ваш промпт должен содержать:", "items": [
      "Роль (R): Персона с контекстом",
      "Инструкции (I): Чёткая задача",
      "Шаги (S): Алгоритм выполнения",
      "Цель (E): Формат результата",
      "Ограничения (N): Чего избегать"
    ]},

    {"type": "heading", "content": "Бонусные элементы"},
    {"type": "list", "content": "Добавьте хотя бы один:", "items": [
      "Chain-of-Thought: пошаговое рассуждение",
      "Few-shot: 2-3 примера Input → Output"
    ]},

    {"type": "heading", "content": "Шаблон"},
    {"type": "example", "content": "# РОЛЬ\nТы — [профессия] с [опыт] в [сфера].\n\n# ЗАДАЧА\n[Глагол] [что сделать] для [кого].\n\n# ШАГИ\n1. [Шаг 1]\n2. [Шаг 2]\n3. [Шаг 3]\n\n# ФОРМАТ\n- Длина: [слова/пункты]\n- Стиль: [формальный/неформальный]\n\n# ОГРАНИЧЕНИЯ\nНе используй:\n- [ограничение 1]\n- [ограничение 2]", "good": true},

    {"type": "heading", "content": "Идеи для задач"},
    {"type": "list", "content": "По сферам:", "items": [
      "Маркетинг: анализ ЦА, генератор постов",
      "Разработка: code review, генератор тестов",
      "Бизнес: анализ конкурентов, план проекта",
      "Обучение: объяснение тем, проверка знаний"
    ]},

    {"type": "heading", "content": "Порядок выполнения"},
    {"type": "list", "content": "Шаги:", "items": [
      "Выберите задачу из своей практики",
      "Заполните шаблон RISEN",
      "Добавьте CoT или Few-shot",
      "Протестируйте в ChatGPT/Claude",
      "Улучшите на основе результатов"
    ]},

    {"type": "heading", "content": "Что мы изучили"},
    {"type": "list", "content": "Ключевые навыки курса:", "items": [
      "Урок 1: AI не читает мысли — давайте контекст",
      "Урок 2: RISEN — структура промпта",
      "Урок 3: Роли и персоны",
      "Урок 4: Chain-of-Thought",
      "Урок 5: Few-shot Learning",
      "Урок 6: 10 готовых промптов"
    ]},

    {"type": "tip", "content": "Поздравляем! Вы завершили курс \"Основы промптинга\". Теперь вы знаете, как создавать эффективные промпты!"}
  ]'::jsonb,
  7,
  true
);

-- =====================================================
-- Проверка
-- =====================================================
SELECT
  c.id as course_id,
  c.title as course_title,
  COUNT(l.id) as lesson_count,
  SUM(l.duration_minutes) as total_minutes
FROM courses c
LEFT JOIN lessons l ON l.course_id = c.id
WHERE c.id = 'prompt-engineering'
GROUP BY c.id, c.title;
